{% extends "base.html" %}

{% block content %}
<div class="container text-center mt-5 mb-4 weather-header">
    <div class="d-flex justify-content-center align-items-center">
        <img src="{{ url_for('static', filename='assets/img/weather_icon.png') }}" alt="Weather Icon">
        <h1 class="app-title mb-0">Weather App</h1>
    </div>

    <form class="d-flex justify-content-center mt-3" method="POST" action="{{ url_for('add_city') }}">
        <input 
            class="form-control city-input" 
            type="search" 
            placeholder="Enter a city" 
            name="city_name"
            style="max-width: 300px;"
        >
        <button class="btn btn-primary add-city-btn" type="submit">Add City</button>
    </form>
</div>


<div class="container px-4 px-lg-5 py-5">

    {# Flash Messages #}
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="alert alert-{{ 'info' if category == 'message' else category }} alert-dismissible fade show" role="alert">
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            {% endfor %}
        {% endif %}
    {% endwith %}


    <div class="row gx-4 gy-4 justify-content-center">
        {% if all_weather_city %}
            {% for city in all_weather_city %}
            <div class="col-md-5">

                <div class="card weather-card h-100">

                    <a href="{{ url_for('delete_city', city_id=city.id) }}"
                       class="card-close-btn" aria-label="Remove city">
                        <i class="fas fa-times"></i>
                    </a>

                    <div class="card-body">

                        <!-- Top Section -->
                        <div class="row align-items-center card-top-header bg-{{ (city.id % 6) + 1 }}">

                            <div class="col-7 text-center">
                                <h5 class="card-title mb-0">{{ city.name }}, {{ city.country }}</h5>
                                <p class="small mb-1">{{ city.dt_formatted }}</p>

                                <div class="d-flex justify-content-center align-items-center">
                                    {% if city.icon %}
                                        <img src="https://openweathermap.org/img/wn/{{ city.icon }}.png"
                                             class="weather-icon-small me-2"
                                             alt="{{ city.description }}">
                                    {% endif %}
                                    <span class="weather-description">{{ city.description|title }}</span>
                                </div>
                            </div>

                            <div class="col-5 text-center">
                                <p class="temp-main mb-0">
                                    {{ city.temp|round|int if city.temp is not none else 'N/A' }}°C
                                </p>
                                {% if city.temp_min is not none %}
                                    <p class="temp-range small">Min: {{ city.temp_min|round|int }}°C</p>
                                {% endif %}
                                {% if city.temp_max is not none %}
                                    <p class="temp-range small">Max: {{ city.temp_max|round|int }}°C</p>
                                {% endif %}
                            </div>

                        </div>

                        <!-- Make whole card clickable -->
                        <a href="{{ url_for('show_city_detail', city_id=city.id) }}"
                           class="stretched-link"
                           aria-label="View details"></a>

                        <!-- Details Section -->
                        <div class="row weather-details">

                            <div class="col-4 text-left">
                                <div class="detail-item">Pressure: {{ city.pressure }} hPa</div>
                                <div class="detail-item">Humidity: {{ city.humidity }}%</div>
                                <div class="detail-item">Visibility: {{ city.visibility }} km</div>
                            </div>

                            <div class="col-4 text-center border-start border-white border-opacity-25">
                                <div class="detail-item">Wind: {{ city.wind_speed }} m/s</div>
                            </div>

                            <div class="col-4 text-center border-start border-white border-opacity-25">
                                <div class="detail-item">
                                    <i class="fas fa-arrow-up"></i> Sunrise: {{ city.sunrise_formatted }}
                                </div>
                                <div class="detail-item">
                                    <i class="fas fa-arrow-down"></i> Sunset: {{ city.sunset_formatted }}
                                </div>
                            </div>

                        </div>

                    </div>
                </div>
            </div>
            {% endfor %}

        {% else %}
            <div class="col-12 text-center text-white-50">
                No weather data to display.
            </div>
        {% endif %}
    </div>
</div>

{% include "footer.html" %}
{% endblock %}
